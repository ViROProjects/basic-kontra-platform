!function(t){var i={};function e(s){if(i[s])return i[s].exports;var h=i[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,e),h.l=!0,h.exports}e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var h in t)e.d(s,h,function(i){return t[i]}.bind(null,h));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=0)}([function(t,i,e){"use strict";e.r(i);let s,h,r={};function n(t,...i){r[t]&&r[t].map(t=>t(...i))}function o(){return s}function a(){return h}function c(t){if(s=document.getElementById(t)||t||document.querySelector("canvas"),!s)throw Error("You must provide a canvas element for the game");return h=s.getContext("2d"),h.imageSmoothingEnabled=!1,n("init"),{canvas:s,context:h}}class l{constructor({spriteSheet:t,frames:i,frameRate:e,loop:s=!0}={}){this.spriteSheet=t,this.frames=i,this.frameRate=e,this.loop=s;let{width:h,height:r,margin:n=0}=t.frame;this.width=h,this.height=r,this.margin=n,this._f=0,this._a=0}clone(){return d(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:i,width:e=this.width,height:s=this.height,context:h=a()}={}){let r=this.frames[this._f]/this.spriteSheet._f|0,n=this.frames[this._f]%this.spriteSheet._f|0;h.drawImage(this.spriteSheet.image,n*this.width+(2*n+1)*this.margin,r*this.height+(2*r+1)*this.margin,this.width,this.height,t,i,e,s)}}function d(t){return new l(t)}d.prototype=l.prototype,d.class=l;new WeakMap;const f=()=>{};function u(){let t=o();a().clearRect(0,0,t.width,t.height)}function p({fps:t=60,clearCanvas:i=!0,update:e,render:s}={}){if(!e||!s)throw Error("You must provide update() and render() functions");let h,r,o,a,c,l=0,d=1e3/t,p=1/t,y=i?u:f;function g(){if(r=requestAnimationFrame(g),o=performance.now(),a=o-h,h=o,!(a>1e3)){for(n("tick"),l+=a;l>=d;)c.update(p),l-=d;y(),c.render()}}return c={update:e,render:s,isStopped:!0,start(){h=performance.now(),this.isStopped=!1,requestAnimationFrame(g)},stop(){this.isStopped=!0,cancelAnimationFrame(r)},_frame:g,set _last(t){h=t}},c}let y={},g={},x={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"left",ArrowUp:"up",ArrowRight:"right",ArrowDown:"down",13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};function m(t){let i=x[t.code||t.which];g[i]=!0,y[i]&&y[i](t)}function w(t){g[x[t.code||t.which]]=!1}function _(){g={}}function b(){let t;for(t=0;t<26;t++)x[t+65]=x["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)x[48+t]=x["Digit"+t]=""+t;window.addEventListener("keydown",m),window.addEventListener("keyup",w),window.addEventListener("blur",_)}function v(t){return!!g[t]}class S{constructor({create:t,maxSize:i=1024}={}){let e;if(!t||!(e=t())||!(e.update&&e.init&&e.isAlive))throw Error("Must provide create() function which returns an object with init(), update(), and isAlive() functions");this._c=t,this.objects=[t()],this.size=0,this.maxSize=i}get(t={}){if(this.size===this.objects.length){if(this.size===this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.push(this._c())}let i=this.objects[this.size];return this.size++,i.init(t),i}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(t){let i,e=!1;for(let s=this.size;s--;)i=this.objects[s],i.update(t),i.isAlive()||(e=!0,this.size--);e&&this.objects.sort((t,i)=>i.isAlive()-t.isAlive())}render(){for(let t=this.size;t--;)this.objects[t].render()}}function A(t){return new S(t)}function j(t,i){let e=[],s=i.x+i.width/2,h=i.y+i.height/2,r=t.y<h&&t.y+t.height>=i.y,n=t.y+t.height>=h&&t.y<i.y+i.height;return t.x<s&&t.x+t.width>=i.x&&(r&&e.push(0),n&&e.push(2)),t.x+t.width>=s&&t.x<i.x+i.width&&(r&&e.push(1),n&&e.push(3)),e}A.prototype=S.prototype,A.class=S;class z{constructor({maxDepth:t=3,maxObjects:i=25,bounds:e}={}){this.maxDepth=t,this.maxObjects=i;let s=o();this.bounds=e||{x:0,y:0,width:s.width,height:s.height},this._b=!1,this._d=0,this._o=[],this._s=[],this._p=null}clear(){this._s.map((function(t){t.clear()})),this._b=!1,this._o.length=0}get(t){let i,e,s=new Set;for(;this._s.length&&this._b;){for(i=j(t,this.bounds),e=0;e<i.length;e++)this._s[i[e]].get(t).forEach(t=>s.add(t));return Array.from(s)}return this._o.filter(i=>i!==t)}add(){let t,i,e,s;for(i=0;i<arguments.length;i++)if(e=arguments[i],Array.isArray(e))this.add.apply(this,e);else if(this._b)this._a(e);else if(this._o.push(e),this._o.length>this.maxObjects&&this._d<this.maxDepth){for(this._sp(),t=0;s=this._o[t];t++)this._a(s);this._o.length=0}}_a(t,i,e){for(i=j(t,this.bounds),e=0;e<i.length;e++)this._s[i[e]].add(t)}_sp(t,i,e){if(this._b=!0,!this._s.length)for(t=this.bounds.width/2|0,i=this.bounds.height/2|0,e=0;e<4;e++)this._s[e]=E({bounds:{x:this.bounds.x+(e%2==1?t:0),y:this.bounds.y+(e>=2?i:0),width:t,height:i},maxDepth:this.maxDepth,maxObjects:this.maxObjects}),this._s[e]._d=this._d+1,this._s[e]._p=this}}function E(t){return new z(t)}E.prototype=z.prototype,E.class=z;class O{constructor(t=0,i=0){this._x=t,this._y=i}add(t,i=1){return R(this.x+(t.x||0)*i,this.y+(t.y||0)*i,this)}clamp(t,i,e,s){this._c=!0,this._a=t,this._b=i,this._d=e,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}function R(t,i,e={}){let s=new O(t,i);return e._c&&(s.clamp(e._a,e._b,e._d,e._e),s.x=t,s.y=i),s}R.prototype=O.prototype,R.class=O;class T{constructor(t){this.init(t)}init(t={}){let{x:i,y:e,dx:s,dy:h,ddx:r,ddy:n,width:o,height:c,image:l}=t;this.position=R(i,e),this.velocity=R(s,h),this.acceleration=R(r,n),this._fx=this._fy=1,this.width=this.height=this.rotation=0,this.ttl=1/0,this.anchor={x:0,y:0},this.context=a();for(let i in t)this[i]=t[i];l&&(this.width=void 0!==o?o:l.width,this.height=void 0!==c?c:l.height),this.sx=0,this.sy=0}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}get animations(){return this._a}get viewX(){return this.x-this.sx}get viewY(){return this.y-this.sy}get width(){return this._w}get height(){return this._h}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}set animations(t){let i,e;for(i in this._a={},t)this._a[i]=t[i].clone(),e=e||this._a[i];this.currentAnimation=e,this.width=this.width||e.width,this.height=this.height||e.height}set viewX(t){}set viewY(t){}set width(t){let i=t<0?-1:1;this._fx=i,this._w=t*i}set height(t){let i=t<0?-1:1;this._fy=i,this._h=t*i}isAlive(){return this.ttl>0}collidesWith(t){if(this.rotation||t.rotation)return null;let i=this.x-this.width*this.anchor.x,e=this.y-this.height*this.anchor.y,s=t.x,h=t.y;return t.anchor&&(s-=t.width*t.anchor.x,h-=t.height*t.anchor.y),i<s+t.width&&i+this.width>s&&e<h+t.height&&e+this.height>h}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){this.velocity=this.velocity.add(this.acceleration,t),this.position=this.position.add(this.velocity,t),this.ttl--,this.currentAnimation&&this.currentAnimation.update(t)}draw(){let t=-this.width*this.anchor.x,i=-this.height*this.anchor.y;if(this.context.save(),this.context.translate(this.viewX,this.viewY),this.rotation&&this.context.rotate(this.rotation),-1==this._fx||-1==this._fy){let e=this.width/2+t,s=this.height/2+i;this.context.translate(e,s),this.context.scale(this._fx,this._fy),this.context.translate(-e,-s)}this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,t,i,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:t,y:i,width:this.width,height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(t,i,this.width,this.height)),this.context.restore()}}function M(t){return new T(t)}function W(t){if(+t===t)return t;let i=[],e=t.split(".."),s=+e[0],h=+e[1],r=s;if(s<h)for(;r<=h;r++)i.push(r);else for(;r>=h;r--)i.push(r);return i}M.prototype=T.prototype,M.class=T;class C{constructor({image:t,frameWidth:i,frameHeight:e,frameMargin:s,animations:h}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:i,height:e,margin:s},this._f=t.width/i|0,this.createAnimations(h)}createAnimations(t){let i,e;for(e in t){let{frames:s,frameRate:h,loop:r}=t[e];if(i=[],void 0===s)throw Error("Animation "+e+" must provide a frames property");[].concat(s).map(t=>{i=i.concat(W(t))}),this.animations[e]=d({spriteSheet:this,frames:i,frameRate:h,loop:r})}}}function P(t){return new C(t)}P.prototype=C.prototype,P.class=C;let D,k,Y,G,{canvas:B,context:I}=c();b();class L{constructor(t){this.finish=!0}update(){}render(){I.fillText("Generic Title Screen",20,30),I.fillText("A game for you",30,45),I.fillText("By ViRO",20,60),I.fillText("<Press ENTER>",40,80),I.fillText("Collect yellow, avoid Red, finish on Purple bar",10,100),I.fillText("finish on Purple bar",10,125)}}class q{constructor(t){D=[],k=[],Y=[],G=[],this.finish=!1,this.sprite=new F(t.sprite);for(let i of t.bads)k.push(new M(i));for(let i of t.yess)Y.push(new M(i));for(let i of t.victor)G.push(new M(i));for(let i of t.arrs)D.push(new M(i))}update(){this.sprite.update(),this.sprite.x>B.width&&(this.sprite.x=-this.sprite.width),this.sprite.finish&&(this.finish=!0),this.sprite.mission&&(G[0].color="BlueViolet")}render(){for(let t of D)t.render();for(let t of k)t.render();for(let t of Y)t.render();for(let t of G)t.render();I.fillText(`lives: ${this.sprite.life}  score: ${this.sprite.score}`,0,0),this.sprite.finish?I.fillText(this.sprite.victory?"victory <press enter>":"defeated <press enter>",50,30):this.sprite.render()}}class F extends M.class{constructor(t){super(t),this.onGround=!1,this.life=3,this.score=0,this.initial=this.position,this.mission=!1,this.finish=!1,this.victory=!1}update(){this.finish||(this.dx=0,this.dy=this.dy<6?this.dy+1:6,G.filter(t=>this.collidesWith(t)).length&&this.mission&&(this.finish=!0,this.victory=!0),k.filter(t=>this.collidesWith(t)).length&&(this.life>0?(this.position=this.initial,this.life-=1):this.finish=!0),Y.filter(t=>this.collidesWith(t)).length&&(this.score+=Y.filter(t=>this.collidesWith(t)).length,Y=Y.filter(t=>!this.collidesWith(t))),this.score>=3&&(this.mission=!0),v("left")?this.dx=-2.6:v("right")&&(this.dx=2.6),v("up")&&this.onGround?(this.dy=-12,this.onGround=!1):D.filter(t=>this.collidesWith(t)).length&&(this.dy=0,this.y=D.filter(t=>this.collidesWith(t))[0].y-this.height,this.onGround=!0),this.advance())}}(new class{newScene(){return new q({sprite:{x:0,y:80,color:"blue",width:20,height:20,anchor:{x:0,y:0}},arrs:[{x:0,y:100,color:"green",width:300,height:20,anchor:{x:0,y:0}}],bads:[{x:100,y:80,color:"red",width:20,height:20,anchor:{x:0,y:0}}],yess:[{x:70,y:50,color:"yellow",width:10,height:10,anchor:{x:0,y:0}},{x:150,y:50,color:"yellow",width:10,height:10,anchor:{x:0,y:0}},{x:210,y:50,color:"yellow",width:10,height:10,anchor:{x:0,y:0}}],victor:[{x:280,y:0,color:"black",width:10,height:100,anchor:{x:0,y:0}}]})}constructor(){this.scene=new L,this.gameloop=p({update:()=>{this.scene.finish&&v("enter")?this.scene=this.newScene():this.scene.update()},render:()=>{I.fillStyle="black",I.font="16px Courier New",I.textBaseline="top",this.scene.render()}})}}).gameloop.start()}]);